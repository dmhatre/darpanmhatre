{
  "name": "connect-once",
  "version": "0.1.1",
  "description": "Request connection once and memorize it for later",
  "main": "index.js",
  "scripts": {
    "test": "istanbul test _mocha --report html -- test/*.js -R spec -t 1000",
    "coveralls": "istanbul cover ./node_modules/mocha/bin/_mocha --report lcovonly -- test/*.js -R spec -t 1000 && cat ./coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js && rm -rf ./coverage"
  },
  "devDependencies": {
    "mocha": "~1.17.1",
    "coveralls": "~2.8.0",
    "mocha-lcov-reporter": "0.0.1",
    "istanbul": "~0.2.6",
    "should": "~3.1.3",
    "gulp": "~3.5.5",
    "gulp-gh-pages": "0.0.1",
    "gulp-jsdoc": "~0.1.0",
    "is": "~0.3.0"
  },
  "repository": {
    "type": "git",
    "url": "git://github.com/floatdrop/connect-once.git"
  },
  "author": {
    "name": "Vsevolod Strukchinsky",
    "email": "floatdrop@gmail.com"
  },
  "license": "MIT",
  "bugs": {
    "url": "https://github.com/floatdrop/connect-once/issues"
  },
  "homepage": "https://github.com/floatdrop/connect-once",
  "readme": "# connect-once [![NPM version][npm-image]][npm-url] [![Build Status][travis-image]][travis-url] [![Coverage Status][coveralls-image]][coveralls-url] [![Dependency Status][depstat-image]][depstat-url]\n> Memorizing async function result\n\nThis module solves [problem](http://stackoverflow.com/questions/6275643/node-js-design-pattern-for-creating-db-connection-once/25209316#25209316) with connection creating in Node.JS.\n\nMost known example - MongoDB connections. Often you want to get one connection shared with all incoming requests. However there are two edges, that can hurt you, when your application starting under significant load. Connection should be:\n\n * Created once for all requests, that are coming at the same time - otherwise you can take down your database connection pool.\n * Ready before first request arrives - to reduce page loading time.\n\nAlso it is nice to have some retries, when database decides to take a rest. For this (and other) tasks connect-once was written. \n\n## Usage\n\nYou can see [express-mongo-db](https://github.com/floatdrop/express-mongo-db) and [express-mongoose-db](https://github.com/floatdrop/express-mongoose-db) as real-life examples of connect-once usage.\n\nInstall package with npm:\n\n`npm i connect-once --save`\n\nThen create a connection:\n\n```js\nvar connectOnce = require('connect-once');\n\nvar connection = new connectOnce({ \n    retries: 60, \n    reconnectWait: 1000\n}, MongoClient.connect, 'mongodb://localhost/test');\n\nconnection.when('available', function (err, db) {\n    // Do stuff\n});\n```\n\n## Heartbeat\n\nHeartbeat is useful, when you want check connection from time to time. For example, if you working with mongodb and cache connection to db - what happens when server, which connection binded to goes to heaven? Connection is lost and programmer should recreate it.\n\n__Note:__ for now there is no way to stop heartbeats.\n\n```js\nvar connectOnce = require('connect-once');\n\nvar connection = new connectOnce({ \n    heartbeat: function (db, beat) {\n        db.stats(function (err) {\n            if (!err) { beat(); }\n        });\n    }\n}, MongoClient.connect, 'mongodb://localhost/test');\n\nconnection.when('available', function (err, db) {\n    // Do stuff\n});\n```\n\n## Force retry (update cached value)\n\nThere are interesting use case of connect-once in a wild: it can be used as some sort of in-memory cache. Because it consumes general function with callback - there is no difference, what to memorize - connection or abstract object.\n\nSuppose you have a function `getCache(callback)`, that invokes `callback` with next arguments: `null, new Date()`. To update cached value from time-to time you can use next code:\n\n```js\nvar connectOnce = require('connect-once');\nvar connection = new connectOnce(getCache);\nsetInterval(function () {\n    connection.retry(new Error('Update cache'));\n}, 5000);\n```\n\nAlso `available` event will be fired every 5000 seconds.\n\n## API\n\nYou can read [source code](https://github.com/floatdrop/connect-once/blob/master/index.js) (65 sloc!) or generated [documentation of Connection class](http://floatdrop.github.io/connect-once/Connection.html) which is not very nice. \n\n# License\n\n(MIT License) (c) 2013 Vsevolod Strukchinsky (floatdrop@gmail.com)\n\n\n[npm-url]: https://npmjs.org/package/connect-once\n[npm-image]: https://badge.fury.io/js/connect-once.png\n\n[travis-url]: http://travis-ci.org/floatdrop/connect-once\n[travis-image]: https://travis-ci.org/floatdrop/connect-once.png?branch=master\n\n[coveralls-url]: https://coveralls.io/r/floatdrop/connect-once\n[coveralls-image]: https://coveralls.io/repos/floatdrop/connect-once/badge.png\n\n[depstat-url]: https://david-dm.org/floatdrop/connect-once\n[depstat-image]: https://david-dm.org/floatdrop/connect-once.png?theme=shields.io\n",
  "readmeFilename": "README.md",
  "_id": "connect-once@0.1.1",
  "dist": {
    "shasum": "02852a847d0f7c2e0b9a7b844ec80d29d04135e6"
  },
  "_from": "connect-once@~0.1.0",
  "_resolved": "https://registry.npmjs.org/connect-once/-/connect-once-0.1.1.tgz"
}
